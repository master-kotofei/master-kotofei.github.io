@echo off
setlocal enabledelayedexpansion
chcp 65001 >nul
REM Batch ัะบัะธะฟั ะพััะฐะฝะพะฒะบะธ Hugo ัะตัะฒะตัะฐ ะธ ะพัะฒะพะฑะพะถะดะตะฝะธั ัะตััััะพะฒ

echo ๐ ะััะฐะฝะพะฒะบะฐ Hugo ัะตัะฒะตัะฐ...

REM ะะพะธัะบ ะธ ะทะฐะฒะตััะตะฝะธะต ะฟัะพัะตััะพะฒ Hugo
echo ๐ ะะพะธัะบ ะฟัะพัะตััะพะฒ Hugo...
tasklist /FI "IMAGENAME eq hugo.exe" 2>nul | find /I "hugo.exe" >nul
if %errorlevel% equ 0 (
    echo ๐ ะะฐะนะดะตะฝั ะฟัะพัะตััั Hugo
    echo ๐ ะะฐะฒะตััะตะฝะธะต ะฟัะพัะตััะพะฒ Hugo...
    taskkill /F /IM hugo.exe >nul 2>&1
    timeout /t 2 >nul
    echo โ ะัะพัะตััั Hugo ะทะฐะฒะตััะตะฝั
) else (
    echo โน๏ธ  ะะบัะธะฒะฝัะต ะฟัะพัะตััั Hugo ะฝะต ะฝะฐะนะดะตะฝั
)

REM ะัะพะฒะตัะบะฐ ะธ ะพัะฒะพะฑะพะถะดะตะฝะธะต ะฟะพััะฐ 1313
echo ๐ ะัะพะฒะตัะบะฐ ะฟะพััะฐ 1313...
set PORT_FOUND=0
for /f "tokens=5" %%a in ('netstat -ano ^| findstr ":1313"') do (
    if not "%%a"=="0" (
        set PORT_FOUND=1
        echo ๐ ะะพัั 1313 ะทะฐะฝัั ะฟัะพัะตััะพะผ ั PID: %%a
        echo ๐ ะะฐะฒะตััะตะฝะธะต ะฟัะพัะตััะฐ ั PID: %%a
        taskkill /F /PID %%a >nul 2>&1
        if !errorlevel! equ 0 (
            echo โ ะัะพัะตัั %%a ะทะฐะฒะตััะตะฝ
        ) else (
            echo โ๏ธ  ะะต ัะดะฐะปะพัั ะทะฐะฒะตััะธัั ะฟัะพัะตัั %%a
        )
    )
)
if !PORT_FOUND! equ 0 (
    echo โน๏ธ  ะะพัั 1313 ัะฒะพะฑะพะดะตะฝ ะธะปะธ ัะพะดะตัะถะธั ัะพะปัะบะพ TIME_WAIT ัะพะตะดะธะฝะตะฝะธั
    echo โ ะะพัั ะณะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
) else (
    timeout /t 2 >nul
    netstat -ano | findstr ":1313" | findstr /v "TIME_WAIT" >nul
    if %errorlevel% equ 0 (
        echo โ๏ธ  ะะพัั 1313 ะฒัะต ะตัะต ะทะฐะฝัั ะฐะบัะธะฒะฝัะผะธ ะฟัะพัะตััะฐะผะธ
    ) else (
        echo โ ะะพัั 1313 ะพัะฒะพะฑะพะถะดะตะฝ
    )
)

REM ะัะธััะบะฐ ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ Hugo
echo ๐งน ะัะธััะบะฐ ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ...
if exist "resources\_gen" (
    rmdir /s /q "resources\_gen" >nul 2>&1
    echo โ ะัะตะผะตะฝะฝัะต ัะฐะนะปั ัะดะฐะปะตะฝั
)

REM ะฃะดะฐะปะตะฝะธะต ะปะพะณ-ัะฐะนะปะฐ
if exist "hugo-dev.log" (
    del "hugo-dev.log" >nul 2>&1
    echo โ ะะพะณ-ัะฐะนะป ัะดะฐะปะตะฝ
)

echo.
echo ๐ Hugo ัะตัะฒะตั ะฟะพะปะฝะพัััั ะพััะฐะฝะพะฒะปะตะฝ ะธ ัะตััััั ะพัะฒะพะฑะพะถะดะตะฝั!
echo ๐ก ะะปั ะทะฐะฟััะบะฐ ะธัะฟะพะปัะทัะนัะต: start-dev.bat
